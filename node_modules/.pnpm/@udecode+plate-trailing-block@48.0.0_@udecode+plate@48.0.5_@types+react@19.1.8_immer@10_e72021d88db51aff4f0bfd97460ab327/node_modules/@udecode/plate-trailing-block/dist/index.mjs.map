{"version":3,"sources":["../src/lib/TrailingBlockPlugin.ts","../src/lib/withTrailingBlock.ts"],"sourcesContent":["import {\n  type PluginConfig,\n  type QueryNodeOptions,\n  BaseParagraphPlugin,\n  createTSlatePlugin,\n} from '@udecode/plate';\n\nimport { withTrailingBlock } from './withTrailingBlock';\n\nexport type TrailingBlockConfig = PluginConfig<\n  'trailingBlock',\n  {\n    /** Level where the trailing node should be, the first level being 0. */\n    level?: number;\n    /** Type of the trailing block */\n    type?: string;\n  } & QueryNodeOptions\n>;\n\n/** @see {@link withTrailingBlock} */\nexport const TrailingBlockPlugin = createTSlatePlugin<TrailingBlockConfig>({\n  key: 'trailingBlock',\n  options: {\n    level: 0,\n  },\n})\n  .overrideEditor(withTrailingBlock)\n  .extend(({ editor }) => ({\n    options: {\n      type: editor.getType(BaseParagraphPlugin),\n    },\n  }));\n","import { type OverrideEditor, PathApi, queryNode } from '@udecode/plate';\n\nimport type { TrailingBlockConfig } from './TrailingBlockPlugin';\n\n/**\n * Add a trailing block when the last node type is not `type` and when the\n * editor has .\n */\nexport const withTrailingBlock: OverrideEditor<TrailingBlockConfig> = ({\n  editor,\n  getOptions,\n  tf: { normalizeNode },\n}) => ({\n  transforms: {\n    normalizeNode([currentNode, currentPath]) {\n      const { level, type, ...query } = getOptions();\n\n      if (currentPath.length === 0) {\n        const lastChild = editor.api.last([], { level });\n        const lastChildNode = lastChild?.[0];\n\n        if (\n          !lastChildNode ||\n          (lastChildNode.type !== type && queryNode(lastChild, query))\n        ) {\n          const at = lastChild ? PathApi.next(lastChild[1]) : [0];\n\n          editor.tf.insertNodes(editor.api.create.block({ type }, at), { at });\n\n          return;\n        }\n      }\n\n      return normalizeNode([currentNode, currentPath]);\n    },\n  },\n});\n"],"mappings":";AAAA;AAAA,EAGE;AAAA,EACA;AAAA,OACK;;;ACLP,SAA8B,SAAS,iBAAiB;AAQjD,IAAM,oBAAyD,CAAC;AAAA,EACrE;AAAA,EACA;AAAA,EACA,IAAI,EAAE,cAAc;AACtB,OAAO;AAAA,EACL,YAAY;AAAA,IACV,cAAc,CAAC,aAAa,WAAW,GAAG;AACxC,YAAM,EAAE,OAAO,MAAM,GAAG,MAAM,IAAI,WAAW;AAE7C,UAAI,YAAY,WAAW,GAAG;AAC5B,cAAM,YAAY,OAAO,IAAI,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAC/C,cAAM,gBAAgB,YAAY,CAAC;AAEnC,YACE,CAAC,iBACA,cAAc,SAAS,QAAQ,UAAU,WAAW,KAAK,GAC1D;AACA,gBAAM,KAAK,YAAY,QAAQ,KAAK,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;AAEtD,iBAAO,GAAG,YAAY,OAAO,IAAI,OAAO,MAAM,EAAE,KAAK,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AAEnE;AAAA,QACF;AAAA,MACF;AAEA,aAAO,cAAc,CAAC,aAAa,WAAW,CAAC;AAAA,IACjD;AAAA,EACF;AACF;;;ADhBO,IAAM,sBAAsB,mBAAwC;AAAA,EACzE,KAAK;AAAA,EACL,SAAS;AAAA,IACP,OAAO;AAAA,EACT;AACF,CAAC,EACE,eAAe,iBAAiB,EAChC,OAAO,CAAC,EAAE,OAAO,OAAO;AAAA,EACvB,SAAS;AAAA,IACP,MAAM,OAAO,QAAQ,mBAAmB;AAAA,EAC1C;AACF,EAAE;","names":[]}